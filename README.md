# makeBOM

## 概要
EagleCADの出力するBOMからP板.comの部品実装に必要な部品表を作成します。

## 環境
- Python 3
- pandas
- 部品辞書（後述）ファイル

## 使い方

```
$ python3 makeBOM.py BOMファイル名　[シート番号]
```

BOMファイル名と同じディレクトリに、同じファイル名で拡張子がCSVとなったCSVフォーマットのファイルが出力されます。

シート番号がある場合、２つのCSVファイルが出力されます。

一つは、そのシートに書かれた回路の部品だけが独立した部品表、もう一つはそれ以外の部分の部品表です。

CSVファイルのファイル名は、
- シート番号を指定しない場合:　入力ファイル名に \_A がポストフィックス
- シート番号を指定した場合：　入力ファイル名に \_番号 がポストフィックスされたものと　\_R　がポストフィックスされたもの　２つが出力される

出力される部品表は２種類あり、それぞれファイル名に`PBAN`と`kousei`がついています。

- `PBAN`:P板.comの部品表を作成するための部品表
- `kousei`:構成部品表（製品構成を表記するための部品表）を作成するための部品表

総合すると、ファイル名は例えばこんな感じになります。
- `partlist_PBAN_A.csv` P板.com用のファイルで、回路図の全ての部品が網羅されている
- `partlist_kousei_2.csv` 構成部品表用のファイルで、シート２に記載されている部品が網羅されている
- `partlist_PBAN_R.csv`　P板.com用のファイルで、指定したシート以外に記載されている部品が網羅されている

## 仕組み
- Eagleが出力する部品表から、部品番号、部品名、シート番号を取り出す
- 部品名をキーにして、グルーピングする（使用されている部品ごとに、どの部品番号として使われているかをリストアップ）
- 部品名から部品辞書（MI)を引いて、正式名称やメーカなどの情報（部品実装に必要）を取り出す
- それらをマージして部品名ごとに１レコードとなるような部品表をつくる
- CSVファイルに出力する

## 例
上が入力データ、下が出力データ
![image](https://user-images.githubusercontent.com/9587359/112434301-c24ea480-8d86-11eb-91f5-4aa2bd8fe7e2.png)

上のテキストのValue欄の値を元に部品辞書（MI）を検索して必要なデータを付加し、下のようなデータになる。

## 部品辞書ファイル（ＭＩ）
部品辞書ファイルには、部品の正式名やメーカ、形状、はんだ付け端子の数、SMT/THの区別など、部品の情報が入っています。
これは、ユーザサイドで個別に作成する必要がありますが、このスクリプトで使っているものを書いておきます。

１行１レコードで、列番号　` 0, 1, 2, 3, 9, 14 `　に　それぞれ

```
Category：部品の品種名,　Partnumber：型式（正式な型番）,　Mfr：メーカ,　CADname：CAD上での名前(Value),
NumTerminals:端子数,　UnitPrice：単価
```

のデータが入っているCSVファイル

